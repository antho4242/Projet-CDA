<%- include("../partials/header", { title: "Produit" }) %>
<%- include("../partials/nav") %>

<main class="container main">
  <a href="/boutique" class="btn" style="margin-bottom:20px; display:inline-block;">
    â† Retour boutique
  </a>
  <div id="produit-content"><p class="loading">Chargement...</p></div>
</main>

<script>
const id = "<%= produitId %>";
const isClient = "<%= user && user.role === 'client' %>" === "true";

fetch(`/api/produits/${id}`)
  .then(res => { if (!res.ok) throw new Error(); return res.json(); })
  .then(p => {
    document.title = p.Nom_produit;
    const img = p.image
      ? `/images/produits/${p.image}`
      : `/images/produits/default.jpg`;

    const panierBtn = isClient
      ? `<form action="/panier/ajouter" method="POST" style="display:inline">
           <input type="hidden" name="id" value="${p.ID_produit}" />
           <input type="hidden" name="quantite" value="1" />
           <button type="submit" class="btn btn--primary">ğŸ›’ Ajouter au panier</button>
         </form>`
      : `<a href="/auth/login" class="btn btn--primary">ğŸ” Connectez-vous pour commander</a>`;

    document.getElementById("produit-content").innerHTML = `
      <section class="card produit-detail">
        <div class="produit-detail__img">
          <img src="${img}" alt="${p.Nom_produit}"
               onerror="this.src='/images/produits/default.jpg'" />
        </div>
        <div class="produit-detail__info">
          <span class="produit-detail__cat">${p.categorie}</span>
          <h1>${p.Nom_produit}</h1>
          <p>Taille : <strong>${p.Taille_produit}</strong></p>
          <p>RÃ©fÃ©rence : <strong>${p.Reference}</strong></p>
          <p>Stock : <strong class="${p.stock <= 5 ? 'text-danger' : ''}">${p.stock} unitÃ©s</strong></p>
          <div class="produit-detail__prix">${parseFloat(p.Prix).toFixed(2)} â‚¬</div>
          <div class="produit-detail__actions">
            ${panierBtn}
            <a href="/dab/euros/${p.Prix}" class="btn btn--ghost">ğŸ§ Voir en coupures</a>
          </div>
        </div>
      </section>`;
  })
  .catch(() => {
    document.getElementById("produit-content").innerHTML =
      '<p class="alert alert--error">Produit introuvable.</p>';
  });
</script>

<%- include("../partials/footer") %>