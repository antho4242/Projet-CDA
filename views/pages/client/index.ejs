<%- include("../../partials/header", { title }) %>
<%- include("../../partials/nav") %>

<main class="container main">

  <section class="client-hero">
    <h1><%- icon('user', 32) %> Mon Espace</h1>
    <p>Bonjour <strong><%= user.prenom %> <%= user.nom %></strong> — <%= user.email %></p>
  </section>

  <section class="card">
    <h2><%- icon('orders', 24) %> Mes commandes</h2>

    <% if (!commandes.length) { %>
      <p style="color:var(--muted)">Vous n'avez pas encore de commandes.</p>
      <a href="/boutique" class="btn btn--primary" style="margin-top:12px">
        Découvrir la boutique <%- icon('back', 16) %>
      </a>
    <% } else { %>
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>N° Commande</th>
              <th>Date</th>
              <th>Produits</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% commandes.forEach(c => { %>
              <tr>
                <td>#<%= c.ID_commande %></td>
                <td><%= formatDate(c.Date_commande) %></td>
                <td><%= c.nb_produits %> article(s)</td>
                <td>
                  <span class="badge badge--<%= c.Statut_commande === 'Terminé' ? 'success' : c.Statut_commande === 'Annulée' ? 'danger' : 'warning' %>">
                    <%= c.Statut_commande %>
                  </span>
                </td>
                <td style="display:flex; gap:8px;">
                  <a href="/espace-client/commande/<%= c.ID_commande %>"
                     class="btn btn--ghost btn--sm"><%- icon('eye', 16) %> Voir</a>

                  <% if (c.Statut_commande === 'En cours') { %>
                    <form action="/espace-client/commande/<%= c.ID_commande %>/annuler"
                          method="POST"
                          onsubmit="return confirm('Annuler cette commande ?')">
                      <button class="btn btn--danger btn--sm"><%- icon('cancel', 16) %> Annuler</button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </section>

</main>

<%- include("../../partials/footer") %>